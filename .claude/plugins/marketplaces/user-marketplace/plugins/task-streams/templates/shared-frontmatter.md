# Task Frontmatter Formatting Guide

This document defines the standard frontmatter structure and formatting rules for all task-streams task files.

## Overview

All task files in the task-streams system use a consistent YAML frontmatter block at the beginning of the file. This frontmatter contains metadata that enables task tracking, prioritization, and workflow management.

## Frontmatter Structure

```yaml
---
id: T0001
title: Fix authentication bug in login form
priority: P1
component: C05, Authentication & Authorization
status: READY
created: 2025-11-07T10:30:00Z
source: docs/reviews/code-review-2025-11.md
location: src/auth/login.ts:45-67, src/auth/helpers.ts:12-18
estimatedEffort: 4 hours
complexity: Medium
regressionRisk: High
completed: # Optional - ISO 8601 timestamp (filled by task manager)
notes: # Optional - Additional notes (filled by task manager)
---
```

## Field Definitions

### id (Required)
- **Format**: `T####` where `####` is a zero-padded 4-digit number
- **Range**: `T0001` to `T9999`
- **Example**: `T0042`, `T1234`
- **Auto-generated**: Yes, typically generated by the `id-generator` skill
- **Validation**: Must match regex `^T\d{4}$`

### title (Required)
- **Format**: Brief, descriptive text (typically 5-10 words)
- **Guidelines**:
  - Use imperative mood ("Fix bug", not "Fixes bug" or "Fixed bug")
  - Be specific and actionable
  - Avoid redundant prefixes like "Task to..."
  - Keep under 80 characters when possible
- **Examples**:
  - ✓ "Fix authentication bug in login form"
  - ✓ "Add user profile API endpoint"
  - ✗ "Task to fix a bug" (too vague)
  - ✗ "Authentication" (not descriptive enough)

### priority (Required)
- **Format**: `P#` where `#` is 0-3
- **Valid Values**:
  - `P0`: Critical/Emergency - Production down, data loss, security breach
  - `P1`: High - Major feature broken, significant user impact
  - `P2`: Medium - Important but not urgent, moderate impact
  - `P3`: Low - Nice to have, minimal impact, tech debt
- **Example**: `P1`
- **Validation**: Must be one of `P0`, `P1`, `P2`, `P3`

### component (Required)
- **Format**: `C##, Component Name` where `##` is a zero-padded 2-digit number
- **Pattern**: Code followed by comma, space, then component name
- **Range**: `C00` to `C99`
- **Examples**:
  - `C00, General / Cross-Cutting`
  - `C05, Authentication & Authorization`
  - `C12, Payment Processing`
- **Source**: Component codes and names from `component-manager` skill
- **Special**: `C00, General / Cross-Cutting` is the default/fallback
- **Validation**: Must match regex `^C\d{2}, .+$`

### status (Required)
- **Format**: ALL_CAPS keyword
- **Valid Values**:
  - `READY`: Task is ready to be worked on, no blockers
  - `IN_PROGRESS`: Task is currently being worked on
  - `BLOCKED`: Task cannot proceed due to dependencies or issues
  - `DONE`: Task is completed
- **Example**: `READY`
- **Validation**: Must be one of the four valid values

### created (Required)
- **Format**: ISO 8601 timestamp with UTC timezone
- **Pattern**: `YYYY-MM-DDTHH:MM:SSZ`
- **Example**: `2025-11-07T10:30:00Z`
- **Guidelines**:
  - Always use UTC timezone (trailing `Z`)
  - Use 24-hour time format
  - Include seconds
  - Zero-pad all components
- **Validation**: Must match ISO 8601 format

### source (Required)
- **Format**: Relative or absolute file path
- **Guidelines**:
  - Use forward slashes `/` even on Windows
  - Prefer relative paths from project root
  - Include file extension
  - Path should be resolvable
- **Examples**:
  - `docs/specs/feature-x.md`
  - `docs/reviews/code-review-2025-11.md`
  - `docs/security/audit-2025-q4.md`
  - `/absolute/path/to/document.md`

### location (Required)
- **Format**: Comma-separated list of file paths with optional line ranges
- **Pattern**: `path/to/file.ext:start-end` or `path/to/file.ext`
- **Guidelines**:
  - Use forward slashes `/` even on Windows
  - Include line ranges when specific to code location
  - Multiple locations separated by commas
  - Relative paths from project root preferred
- **Examples**:
  - `src/auth/login.ts:45-67`
  - `src/auth/login.ts:45-67, src/auth/helpers.ts:12-18`
  - `config/database.yml, src/models/user.ts:23-45`
  - `docs/README.md` (no line range for documentation)

### estimatedEffort (Required)
- **Format**: Time estimate as human-readable string
- **Guidelines**:
  - Use hours, days, or weeks as appropriate
  - Include research, implementation, and testing time
  - Be realistic, not optimistic
  - Round to reasonable increments
- **Examples**:
  - `2 hours` - Quick fix or small change
  - `4 hours` - Half-day task
  - `1 day` - Full day of work
  - `2 days` - Multi-day task
  - `1 week` - Large feature or refactor
- **Validation**: Must be a non-empty string

### complexity (Required)
- **Format**: Single word descriptor
- **Valid Values**:
  - `Low`: Simple changes, minimal risk, straightforward implementation
  - `Medium`: Moderate complexity, some risk, requires testing
  - `High`: Complex changes, significant risk, extensive testing needed
  - `Very High`: Critical changes, high risk, requires careful planning
- **Example**: `Medium`
- **Validation**: Must be one of the four valid values (case-insensitive)

### regressionRisk (Required)
- **Format**: Single word descriptor
- **Valid Values**:
  - `Low`: Minimal chance of breaking existing functionality
  - `Medium`: Some risk to related features
  - `High`: Significant risk to core functionality
  - `Critical`: High probability of breaking critical systems
- **Example**: `High`
- **Validation**: Must be one of the four valid values (case-insensitive)

### completed (Optional)
- **Format**: ISO 8601 timestamp with UTC timezone
- **Pattern**: `YYYY-MM-DDTHH:MM:SSZ`
- **Example**: `2025-11-07T16:45:00Z`
- **Guidelines**:
  - Same format as `created` field
  - Always use UTC timezone (trailing `Z`)
  - Use 24-hour time format
  - Include seconds
  - Zero-pad all components
- **Usage**: Filled in by task manager when task status changes to `DONE`
- **Default**: Empty/not present until task completion

### notes (Optional)
- **Format**: Free-form text string
- **Guidelines**:
  - Use for additional context, observations, or updates
  - Can be multi-line (use YAML block scalar syntax if needed)
  - Keep concise and relevant
  - Use for task manager annotations
- **Examples**:
  - `Notes added during implementation`
  - `Blocked due to dependency on T0042`
  - `Completed ahead of schedule`
- **Usage**: Filled in by task manager as needed during task lifecycle
- **Default**: Empty/not present until notes are added

## Formatting Rules

### YAML Syntax
- Use standard YAML syntax
- No quotes needed for simple strings
- Use quotes for strings containing special characters (`:`, `#`, etc.)
- One field per line
- Use two-space indentation (when nesting, though frontmatter is flat)

### Whitespace
- Start and end with `---` delimiter lines
- No blank lines between fields
- Single space after colon separator
- No trailing whitespace

### Ordering
Always use this field order:
1. id
2. title
3. priority
4. component
5. status
6. created
7. source
8. location
9. estimatedEffort
10. complexity
11. regressionRisk
12. completed (optional - when present)
13. notes (optional - when present)

## Complete Example

### With Required Fields Only
```yaml
---
id: T0123
title: Implement user authentication middleware
priority: P1
component: C08, API Gateway Layer
status: READY
created: 2025-11-07T14:22:30Z
source: docs/specs/auth-system.md
location: src/middleware/auth.ts:12-45, src/utils/token.ts:23-56
estimatedEffort: 1 day
complexity: High
regressionRisk: Medium
---
```

### With Optional Fields (Completed Task)
```yaml
---
id: T0123
title: Implement user authentication middleware
priority: P1
component: C08, API Gateway Layer
status: DONE
created: 2025-11-07T14:22:30Z
source: docs/specs/auth-system.md
location: src/middleware/auth.ts:12-45, src/utils/token.ts:23-56
estimatedEffort: 1 day
complexity: High
regressionRisk: Medium
completed: 2025-11-08T09:15:00Z
notes: Completed with additional security enhancements
---
```

## Common Mistakes to Avoid

### ❌ Incorrect Formats

```yaml
# Wrong ID format
id: 123          # Missing T prefix
id: T123         # Not zero-padded to 4 digits
id: TASK-0123    # Wrong prefix

# Wrong priority
priority: High   # Use P1 instead
priority: p1     # Must be uppercase
priority: P4     # Invalid priority level

# Wrong component
component: 5                    # Missing C prefix and zero-padding
component: C5                   # Must be zero-padded (C05, Component Name)
component: C05                  # Missing component name
component: C05,Authentication   # Missing space after comma

# Wrong status
status: Done     # Must be uppercase (DONE)
status: WIP      # Not a valid status (use IN_PROGRESS)

# Wrong timestamp
created: 2025-11-07           # Missing time
created: 2025-11-07 10:30:00  # Missing T separator and Z
created: 2025-11-07T10:30     # Missing seconds and Z

# Wrong source
source: code review document  # Use actual path
source: docs\reviews\file.md  # Use forward slashes
```

### ✅ Correct Formats

```yaml
# Required fields only
id: T0123
title: Implement user authentication middleware
priority: P1
component: C08, API Gateway Layer
status: READY
created: 2025-11-07T14:22:30Z
source: docs/specs/auth-system.md
location: src/middleware/auth.ts:12-45, src/utils/token.ts:23-56
estimatedEffort: 1 day
complexity: High
regressionRisk: Medium

# With optional fields
id: T0124
title: Add user profile endpoint
priority: P2
component: C08, API Gateway Layer
status: DONE
created: 2025-11-07T14:22:30Z
source: docs/specs/api-design.md
location: src/api/profile.ts:15-89
estimatedEffort: 4 hours
complexity: Medium
regressionRisk: Low
completed: 2025-11-08T11:30:00Z
notes: Implemented with caching support
```

## Validation

Use the `shared-formatter.ts` script to validate frontmatter:

```bash
# Validate a task file
bun shared-formatter.ts --validate --file="tasks/T0123.md"

# Format/fix a task file
bun shared-formatter.ts --format --file="tasks/T0123.md"

# Parse and display frontmatter
bun shared-formatter.ts --parse --file="tasks/T0123.md"
```

## Template Integration

All template files reference this formatter:

- `bug-findings.template.md`
- `spec.template.md`
- `security.template.md`
- `tech-debt.template.md`
- `generic.template.md`

Each template includes:
```markdown
## <!-- TASK OUTPUT FRONTMATTER STRUCTURE -->

See @shared-frontmatter.md for complete formatting details and validation rules.

```yaml
---
...
---
```
```

### Required Fields (Always Present)
- `id` - T#### format (auto-generated)
- `title` - Brief task description
- `priority` - P0, P1, P2, or P3
- `component` - C##, Component Name (from component-manager)
- `status` - READY, IN_PROGRESS, BLOCKED, DONE
- `created` - ISO 8601 timestamp (auto-generated)
- `source` - Original document path
- `location` - File paths affected (comma-separated or list)
- `estimatedEffort` - Time estimate (e.g., "4 hours", "2 days")
- `complexity` - Low, Medium, High, Very High
- `regressionRisk` - Low, Medium, High, Critical

### Optional Fields (Filled by Task Manager)
- `completed` - ISO 8601 timestamp (when status = DONE)
- `notes` - Additional context or updates

## Programmatic Usage

The `shared-formatter.ts` script provides functions for:
- **Validation**: Check if frontmatter is valid
- **Formatting**: Auto-format frontmatter to correct structure
- **Parsing**: Extract and parse frontmatter from task files
- **Generation**: Create new frontmatter with proper timestamps

See `scripts/shared-formatter.ts` for implementation details.

## Related Documentation

- **Component Management**: See `skills/component-manager/REFERENCE.md`
- **Task ID Generation**: See `skills/id-generator/REFERENCE.md`
- **Priority Guidelines**: See template-specific `PRIORITY_GUIDE.md` files
- **Template Enrichments**: See `SHARED_ENRICHMENTS.md`

## Version History

- **2.0.0** (2025-11-07): Initial shared formatter specification
  - Standardized frontmatter structure across all templates
  - Defined validation rules and formats
  - Created shared-formatter.ts script
