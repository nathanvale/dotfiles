# ~/.config/tmux/tmux-cloud-agents.conf
# Multi-Agent Cloud Workflow Enhancements
# Source this file from your main tmux.conf or load it in cloud-agents sessions

# ============================================================================
# CLOUD AGENT STATUS BAR CUSTOMIZATION
# ============================================================================

# Enhanced status bar with lock count
set-option -g status-right "#($HOME/code/dotfiles/apps/taskdock/ux/tmux/lock-status.sh) #[fg=$FG1,bg=$BG3] %H:%M %d-%b "

# Status update interval (faster for real-time lock updates)
set-option -g status-interval 5

# ============================================================================
# CLOUD AGENT KEYBINDINGS
# ============================================================================

# Quick lock management
bind L display-popup -w 90% -h 85% -E "$HOME/code/dotfiles/apps/taskdock/ux/tmux/show-locks-popup.sh"
bind C run-shell "$HOME/code/dotfiles/apps/taskdock/bin/taskdock locks cleanup && tmux display-message 'Cleaned stale locks'"

# Spawn new worker agent in current window
bind W split-window -h "$HOME/code/dotfiles/apps/taskdock/ux/tmux/next-worker.sh"

# Task Monitor Dashboard
bind M split-window -h "$HOME/code/dotfiles/apps/taskdock/ux/tmux/task-monitor.sh"

# Quick access to lock directory
bind D run-shell "ls -la .git/taskdock-locks/ && read -p 'Press ENTER to close'"

# Broadcast to all worker panes in current window
bind B set-window-option synchronize-panes

# Kill all worker panes (with confirmation)
bind K confirm-before -p "Kill all panes in this window? (y/n)" kill-window

# ============================================================================
# TMUX HOOKS FOR HEARTBEAT & NOTIFICATIONS
# ============================================================================

# Update lock heartbeat when pane gains focus (optional - for manual workflows)
# set-hook -g pane-focus-in 'run-shell "if [ -n \"$TASK_ID\" ]; then $HOME/.claude/scripts/update-lock-heartbeat.sh --quiet \"$TASK_ID\" 2>/dev/null || true; fi"'

# Notify when pane exits (potential crashed agent)
set-hook -g pane-exited 'run-shell "tmux display-message \"‚ö†Ô∏è  Pane exited (potential crashed agent)\""'

# Alert on window activity (useful for monitoring)
set-hook -g alert-activity 'run-shell "tmux display-message \"üì¢ Activity in window: #{window_name}\""'

# ============================================================================
# PANE BORDERS WITH STATUS
# ============================================================================

# Show pane titles (Agent 1, Agent 2, etc.)
set-option -g pane-border-status top
set-option -g pane-border-format "#[fg=cyan,bold] #{?pane_active,üü¢ ,‚ö™ }#{pane_title} #[fg=white]#{?pane_synchronized,üîó SYNC,}"

# ============================================================================
# AUTOMATIC CLEANUP TIMER
# ============================================================================

# Run stale lock cleanup every 10 minutes (600 seconds)
# This runs in background and doesn't block tmux
set-option -g display-time 4000  # Show cleanup notifications for 4 seconds
